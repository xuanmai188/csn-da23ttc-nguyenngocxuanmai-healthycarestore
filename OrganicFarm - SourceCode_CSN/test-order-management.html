<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Order Management</title>
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./fontawesome-free-6.3.0-web/css/all.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2><i class="fas fa-clipboard-list me-2"></i>Test Order Management System</h2>
        
        <div class="alert alert-info">
            <h5><i class="fas fa-info-circle me-2"></i>H∆∞·ªõng d·∫´n test:</h5>
            <ol>
                <li><strong>T·∫°o ƒë∆°n h√†ng COD</strong> - Tr·∫°ng th√°i "Ch·ªù x·ª≠ l√Ω" ‚Üí C√≥ th·ªÉ ch·ªânh s·ª≠a/h·ªßy</li>
                <li><strong>T·∫°o ƒë∆°n h√†ng chuy·ªÉn kho·∫£n</strong> - Tr·∫°ng th√°i "ƒê√£ x·ª≠ l√Ω" ‚Üí Ch·ªâ c√≥ th·ªÉ x√≥a</li>
                <li><strong>Xem l·ªãch s·ª≠</strong> - Ki·ªÉm tra c√°c n√∫t ch·ª©c nƒÉng</li>
                <li><strong>Test ch·ªânh s·ª≠a</strong> - Thay ƒë·ªïi th√¥ng tin giao h√†ng, s·ªë l∆∞·ª£ng s·∫£n ph·∫©m</li>
                <li><strong>Test h·ªßy/x√≥a</strong> - H·ªßy ƒë∆°n pending, x√≥a ƒë∆°n completed</li>
            </ol>
        </div>
        
        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5><i class="fas fa-money-bill-wave me-2"></i>COD Order</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-warning w-100" onclick="createTestCODOrder()">
                            T·∫°o ƒë∆°n h√†ng COD
                        </button>
                        <small class="text-muted d-block mt-2">
                            Tr·∫°ng th√°i: Ch·ªù x·ª≠ l√Ω<br>
                            C√≥ th·ªÉ: Ch·ªânh s·ª≠a, H·ªßy
                        </small>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5><i class="fas fa-university me-2"></i>Bank Transfer</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-success w-100" onclick="createTestBankOrder()">
                            T·∫°o ƒë∆°n chuy·ªÉn kho·∫£n
                        </button>
                        <small class="text-muted d-block mt-2">
                            Tr·∫°ng th√°i: ƒê√£ x·ª≠ l√Ω<br>
                            C√≥ th·ªÉ: X√≥a kh·ªèi l·ªãch s·ª≠
                        </small>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5><i class="fas fa-history me-2"></i>Order History</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-info w-100" onclick="openHistoryModal()">
                            Xem l·ªãch s·ª≠ ƒë∆°n h√†ng
                        </button>
                        <small class="text-muted d-block mt-2">
                            Test c√°c ch·ª©c nƒÉng:<br>
                            Ch·ªânh s·ª≠a, H·ªßy, X√≥a
                        </small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <h4><i class="fas fa-list me-2"></i>Current Orders Status</h4>
            <div id="ordersList"></div>
        </div>
        
        <div class="mt-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-tools me-2"></i>Test Actions</h5>
                </div>
                <div class="card-body">
                    <button class="btn btn-outline-danger me-2" onclick="clearAllOrders()">
                        <i class="fas fa-trash me-1"></i>X√≥a t·∫•t c·∫£ ƒë∆°n h√†ng
                    </button>
                    <button class="btn btn-outline-info" onclick="displayOrders()">
                        <i class="fas fa-refresh me-1"></i>Refresh danh s√°ch
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal History (copy from main files) -->
    <div class="modal fade" id="modalHistory" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-history me-2"></i>L·ªãch s·ª≠ mua h√†ng</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="historyBody">
                    <!-- JS render -->
                </div>
            </div>
        </div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="./js/lst-products.js"></script>
    <script src="./js/auth-cart.js"></script>
    
    <script>
        // Initialize test user
        function initTestUser() {
            const testUser = {
                name: 'Nguy·ªÖn VƒÉn Test',
                username: 'testuser',
                password: 'test123',
                address: '123 ƒê∆∞·ªùng Test, Qu·∫≠n Test, TP.HCM',
                phone: '0987654321',
                role: 'user'
            };
            
            let users = JSON.parse(localStorage.getItem('users')) || [];
            if (!users.find(u => u.username === 'testuser')) {
                users.push(testUser);
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            localStorage.setItem('currentUser', JSON.stringify(testUser));
        }

        function generateOrderId() {
            const timestamp = Date.now().toString().slice(-6);
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `HC${timestamp}${random}`;
        }

        function createTestCODOrder() {
            initTestUser();
            
            const testOrder = {
                id: generateOrderId(),
                date: new Date().toISOString(),
                dateDisplay: new Date().toLocaleString('vi-VN'),
                items: [
                    {
                        id: 1,
                        title: 'Ng≈© c·ªëc ƒÉn s√°ng',
                        price: 397000,
                        quantity: 2,
                        thumbnail: './data/products/1/thumbnail.jpeg'
                    },
                    {
                        id: 3,
                        title: 'B·ªôt ngh·ªá 115g',
                        price: 20000,
                        quantity: 1,
                        thumbnail: './data/products/3/thumbnail.jpg'
                    }
                ],
                status: 'pending',
                paymentMethod: 'cod',
                customerInfo: {
                    name: 'Nguy·ªÖn VƒÉn Test',
                    phone: '0987654321',
                    address: '123 ƒê∆∞·ªùng Test, Qu·∫≠n Test, TP.HCM'
                },
                total: 814000
            };
            
            let allOrders = JSON.parse(localStorage.getItem('orders')) || {};
            if (!allOrders['testuser']) allOrders['testuser'] = [];
            allOrders['testuser'].push(testOrder);
            localStorage.setItem('orders', JSON.stringify(allOrders));
            
            alert('‚úÖ ƒê√£ t·∫°o ƒë∆°n h√†ng COD v·ªõi tr·∫°ng th√°i "Ch·ªù x·ª≠ l√Ω"\n\nüìù C√≥ th·ªÉ ch·ªânh s·ª≠a v√† h·ªßy ƒë∆°n h√†ng n√†y');
            displayOrders();
        }

        function createTestBankOrder() {
            initTestUser();
            
            const testOrder = {
                id: generateOrderId(),
                date: new Date().toISOString(),
                dateDisplay: new Date().toLocaleString('vi-VN'),
                items: [
                    {
                        id: 5,
                        title: 'D·∫ßu d·ª´a nguy√™n ch·∫•t',
                        price: 157000,
                        quantity: 1,
                        thumbnail: './data/products/5/thumbnail.webp'
                    }
                ],
                status: 'completed',
                paymentMethod: 'bank',
                customerInfo: {
                    name: 'Nguy·ªÖn VƒÉn Test',
                    phone: '0987654321',
                    address: '123 ƒê∆∞·ªùng Test, Qu·∫≠n Test, TP.HCM'
                },
                total: 157000
            };
            
            let allOrders = JSON.parse(localStorage.getItem('orders')) || {};
            if (!allOrders['testuser']) allOrders['testuser'] = [];
            allOrders['testuser'].push(testOrder);
            localStorage.setItem('orders', JSON.stringify(allOrders));
            
            alert('‚úÖ ƒê√£ t·∫°o ƒë∆°n h√†ng chuy·ªÉn kho·∫£n v·ªõi tr·∫°ng th√°i "ƒê√£ x·ª≠ l√Ω"\n\nüóëÔ∏è Ch·ªâ c√≥ th·ªÉ x√≥a ƒë∆°n h√†ng n√†y kh·ªèi l·ªãch s·ª≠');
            displayOrders();
        }

        function displayOrders() {
            const allOrders = JSON.parse(localStorage.getItem('orders')) || {};
            const ordersList = document.getElementById('ordersList');
            
            let html = '';
            let orderCount = 0;
            
            Object.keys(allOrders).forEach(username => {
                allOrders[username].forEach(order => {
                    orderCount++;
                    const statusClass = {
                        'pending': 'warning',
                        'completed': 'success',
                        'cancelled': 'danger'
                    }[order.status] || 'secondary';
                    
                    const statusText = {
                        'pending': 'Ch·ªù x·ª≠ l√Ω',
                        'completed': 'ƒê√£ x·ª≠ l√Ω',
                        'cancelled': 'ƒê√£ h·ªßy'
                    }[order.status] || order.status;
                    
                    const paymentText = order.paymentMethod === 'bank' ? 'Chuy·ªÉn kho·∫£n' : 'COD';
                    const paymentIcon = order.paymentMethod === 'bank' ? 'fas fa-university' : 'fas fa-money-bill-wave';
                    
                    const actions = order.status === 'pending' ? 
                        '<i class="fas fa-edit text-primary me-2" title="C√≥ th·ªÉ ch·ªânh s·ª≠a"></i><i class="fas fa-times text-danger" title="C√≥ th·ªÉ h·ªßy"></i>' :
                        '<i class="fas fa-trash text-secondary" title="C√≥ th·ªÉ x√≥a"></i>';
                    
                    html += `
                        <div class="card mb-2">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-3">
                                        <h6 class="mb-1">ƒê∆°n h√†ng #${order.id}</h6>
                                        <small class="text-muted">Kh√°ch h√†ng: ${username}</small>
                                    </div>
                                    <div class="col-md-2">
                                        <i class="${paymentIcon} me-1"></i>${paymentText}
                                    </div>
                                    <div class="col-md-2">
                                        <span class="badge bg-${statusClass}">${statusText}</span>
                                    </div>
                                    <div class="col-md-3">
                                        <strong>${order.total.toLocaleString('vi-VN')}ƒë</strong><br>
                                        <small class="text-muted">${order.items.length} s·∫£n ph·∫©m</small>
                                    </div>
                                    <div class="col-md-2 text-end">
                                        ${actions}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            });
            
            if (orderCount === 0) {
                html = '<div class="alert alert-info"><i class="fas fa-info-circle me-2"></i>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o. H√£y t·∫°o ƒë∆°n h√†ng test ƒë·ªÉ ki·ªÉm tra ch·ª©c nƒÉng!</div>';
            } else {
                html = `<div class="alert alert-success"><i class="fas fa-check-circle me-2"></i>T·ªïng c·ªông: ${orderCount} ƒë∆°n h√†ng</div>` + html;
            }
            
            ordersList.innerHTML = html;
        }

        function clearAllOrders() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ ƒë∆°n h√†ng test?')) {
                localStorage.removeItem('orders');
                alert('‚úÖ ƒê√£ x√≥a t·∫•t c·∫£ ƒë∆°n h√†ng');
                displayOrders();
            }
        }

        // Load orders on page load
        document.addEventListener('DOMContentLoaded', function() {
            initTestUser();
            displayOrders();
        });
    </script>
</body>
</html>