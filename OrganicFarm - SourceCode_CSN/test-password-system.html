<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Password System</title>
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./fontawesome-free-6.3.0-web/css/all.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2><i class="fas fa-key me-2"></i>Test Password Encryption System</h2>
        
        <div class="alert alert-info">
            <h5><i class="fas fa-info-circle me-2"></i>H∆∞·ªõng d·∫´n test:</h5>
            <ol>
                <li><strong>T·∫°o t√†i kho·∫£n m·ªõi</strong> - M·∫≠t kh·∫©u s·∫Ω ƒë∆∞·ª£c m√£ h√≥a t·ª± ƒë·ªông</li>
                <li><strong>ƒêƒÉng nh·∫≠p</strong> - H·ªá th·ªëng h·ªó tr·ª£ c·∫£ m·∫≠t kh·∫©u c≈© v√† m·ªõi</li>
                <li><strong>Xem th√¥ng tin t√†i kho·∫£n</strong> - M·∫≠t kh·∫©u kh√¥ng hi·ªÉn th·ªã</li>
                <li><strong>ƒê·ªïi m·∫≠t kh·∫©u</strong> - Ch·ª©c nƒÉng ƒë·ªïi m·∫≠t kh·∫©u an to√†n</li>
                <li><strong>Ki·ªÉm tra m√£ h√≥a</strong> - Xem m·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c hash</li>
            </ol>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5><i class="fas fa-user-plus me-2"></i>T·∫°o t√†i kho·∫£n test</h5>
                    </div>
                    <div class="card-body">
                        <form onsubmit="createTestAccount(event)">
                            <div class="mb-3">
                                <label class="form-label">T√™n ƒëƒÉng nh·∫≠p</label>
                                <input type="text" id="testUsername" class="form-control" value="testuser2" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">M·∫≠t kh·∫©u</label>
                                <input type="password" id="testPassword" class="form-control" value="password123" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-user-plus me-2"></i>T·∫°o t√†i kho·∫£n
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5><i class="fas fa-sign-in-alt me-2"></i>Test ƒëƒÉng nh·∫≠p</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-success me-2" onclick="openAuthModal()">
                            <i class="fas fa-sign-in-alt me-2"></i>ƒêƒÉng nh·∫≠p
                        </button>
                        <button class="btn btn-info" onclick="openProfileModal()">
                            <i class="fas fa-user me-2"></i>Th√¥ng tin t√†i kho·∫£n
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Password Analysis -->
        <div class="mt-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-search me-2"></i>Ph√¢n t√≠ch m·∫≠t kh·∫©u</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>üîç Test m√£ h√≥a:</h6>
                            <div class="input-group mb-3">
                                <input type="text" id="plainPassword" class="form-control" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" value="password123">
                                <button class="btn btn-outline-secondary" onclick="testEncryption()">
                                    <i class="fas fa-lock"></i> M√£ h√≥a
                                </button>
                            </div>
                            <div class="alert alert-secondary">
                                <strong>M·∫≠t kh·∫©u ƒë√£ m√£ h√≥a:</strong><br>
                                <code id="hashedPassword">Ch∆∞a m√£ h√≥a</code>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>üë• Danh s√°ch user:</h6>
                            <div id="usersList" class="border rounded p-3" style="max-height: 200px; overflow-y: auto;">
                                <!-- Users will be populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Current Status -->
        <div class="mt-4">
            <h4><i class="fas fa-info-circle me-2"></i>Tr·∫°ng th√°i hi·ªán t·∫°i</h4>
            <div id="currentStatus" class="alert alert-secondary">
                <div class="row">
                    <div class="col-md-6">
                        <strong>Ng∆∞·ªùi d√πng hi·ªán t·∫°i:</strong>
                        <span id="currentUser">Ch∆∞a ƒëƒÉng nh·∫≠p</span>
                    </div>
                    <div class="col-md-6">
                        <strong>M·∫≠t kh·∫©u ƒë∆∞·ª£c m√£ h√≥a:</strong>
                        <span id="passwordStatus">Kh√¥ng</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Test Results -->
        <div class="mt-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-clipboard-check me-2"></i>K·∫øt qu·∫£ test</h5>
                </div>
                <div class="card-body">
                    <div id="testResults">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Ch∆∞a c√≥ k·∫øt qu·∫£ test. H√£y th·ª±c hi·ªán c√°c thao t√°c ƒë·ªÉ ki·ªÉm tra h·ªá th·ªëng.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Actions -->
        <div class="mt-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-tools me-2"></i>Test Actions</h5>
                </div>
                <div class="card-body">
                    <button class="btn btn-outline-warning me-2" onclick="clearAllData()">
                        <i class="fas fa-trash me-1"></i>X√≥a t·∫•t c·∫£ d·ªØ li·ªáu
                    </button>
                    <button class="btn btn-outline-info me-2" onclick="updateStatus()">
                        <i class="fas fa-refresh me-1"></i>C·∫≠p nh·∫≠t tr·∫°ng th√°i
                    </button>
                    <button class="btn btn-outline-success" onclick="migrateOldPasswords()">
                        <i class="fas fa-sync me-1"></i>Migrate m·∫≠t kh·∫©u c≈©
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Copy modals from main files -->
    <div class="modal fade" id="modalAuth" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="authTitle">ƒêƒÉng nh·∫≠p</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="authForm">
                        <div class="mb-3" id="authNameWrapper" style="display:none">
                            <label class="form-label">H·ªç v√† t√™n</label>
                            <input type="text" id="authName" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">T√™n ƒëƒÉng nh·∫≠p</label>
                            <input type="text" id="authUsername" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">M·∫≠t kh·∫©u</label>
                            <input type="password" id="authPassword" class="form-control" required>
                        </div>
                        <div class="text-end">
                            <button class="btn btn-success">X√°c nh·∫≠n</button>
                        </div>
                    </form>
                    <hr>
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="#" id="toggleAuth">Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalProfile" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Th√¥ng tin t√†i kho·∫£n</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form onsubmit="updateProfile(event)">
                        <div class="mb-3">
                            <label class="form-label">H·ªç t√™n</label>
                            <input type="text" id="profileName" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">T√™n ƒëƒÉng nh·∫≠p</label>
                            <input type="text" id="profileUsername" class="form-control" required>
                        </div>
                        <hr>
                        <h6 class="mb-3">
                            <i class="fas fa-key me-2"></i>ƒê·ªïi m·∫≠t kh·∫©u
                            <button type="button" class="btn btn-sm btn-outline-primary ms-2" onclick="toggleChangePassword()">
                                <i class="fas fa-edit me-1"></i>Thay ƒë·ªïi
                            </button>
                        </h6>
                        <div id="changePasswordSection" style="display: none;">
                            <div class="mb-3">
                                <label class="form-label">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                                <input type="password" id="currentPassword" class="form-control" placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">M·∫≠t kh·∫©u m·ªõi</label>
                                <input type="password" id="newPassword" class="form-control" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi" minlength="6">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                                <input type="password" id="confirmPassword" class="form-control" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
                            </div>
                        </div>
                        <div class="text-end">
                            <button class="btn btn-success">C·∫≠p nh·∫≠t th√¥ng tin</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="./js/lst-products.js"></script>
    <script src="./js/auth-cart.js"></script>
    
    <script>
        // Test functions
        function createTestAccount(e) {
            e.preventDefault();
            const username = document.getElementById('testUsername').value;
            const password = document.getElementById('testPassword').value;
            
            let users = JSON.parse(localStorage.getItem('users')) || [];
            
            if (users.find(u => u.username === username)) {
                addTestResult('warning', `User ${username} ƒë√£ t·ªìn t·∫°i`);
                return;
            }
            
            const newUser = {
                name: 'Test User',
                username: username,
                passwordHash: hashPassword(password),
                role: 'user'
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            addTestResult('success', `‚úÖ T·∫°o th√†nh c√¥ng user: ${username} v·ªõi m·∫≠t kh·∫©u ƒë√£ m√£ h√≥a`);
            updateStatus();
            displayUsers();
        }

        function testEncryption() {
            const plainPassword = document.getElementById('plainPassword').value;
            if (!plainPassword) return;
            
            const hashed = hashPassword(plainPassword);
            document.getElementById('hashedPassword').textContent = hashed;
            
            addTestResult('info', `üîê M√£ h√≥a "${plainPassword}" ‚Üí "${hashed.substring(0, 20)}..."`);
        }

        function updateStatus() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            document.getElementById('currentUser').textContent = 
                currentUser ? `${currentUser.name} (${currentUser.username})` : 'Ch∆∞a ƒëƒÉng nh·∫≠p';
            
            document.getElementById('passwordStatus').textContent = 
                currentUser && currentUser.passwordHash ? 'C√≥' : 'Kh√¥ng';
        }

        function displayUsers() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const usersList = document.getElementById('usersList');
            
            let html = '';
            users.forEach(user => {
                const hasHash = user.passwordHash ? 'üîê' : 'üîì';
                const hasPlain = user.password ? '‚ö†Ô∏è' : '';
                html += `
                    <div class="mb-2 p-2 border rounded">
                        <strong>${user.username}</strong> ${hasHash} ${hasPlain}<br>
                        <small class="text-muted">
                            ${user.passwordHash ? 'M·∫≠t kh·∫©u ƒë√£ m√£ h√≥a' : 'M·∫≠t kh·∫©u ch∆∞a m√£ h√≥a'}
                        </small>
                    </div>
                `;
            });
            
            usersList.innerHTML = html || '<p class="text-muted">Ch∆∞a c√≥ user n√†o</p>';
        }

        function addTestResult(type, message) {
            const resultsDiv = document.getElementById('testResults');
            const alertClass = `alert-${type}`;
            const icon = {
                'success': 'fas fa-check-circle',
                'warning': 'fas fa-exclamation-triangle', 
                'info': 'fas fa-info-circle',
                'danger': 'fas fa-times-circle'
            }[type] || 'fas fa-info-circle';
            
            const resultHTML = `
                <div class="alert ${alertClass} alert-dismissible fade show">
                    <i class="${icon} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            resultsDiv.innerHTML = resultHTML + resultsDiv.innerHTML;
        }

        function clearAllData() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu?')) {
                localStorage.removeItem('users');
                localStorage.removeItem('currentUser');
                updateStatus();
                displayUsers();
                addTestResult('warning', 'üóëÔ∏è ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu');
            }
        }

        function migrateOldPasswords() {
            let users = JSON.parse(localStorage.getItem('users')) || [];
            let migrated = 0;
            
            users = users.map(user => {
                if (user.password && !user.passwordHash) {
                    user.passwordHash = hashPassword(user.password);
                    delete user.password;
                    migrated++;
                }
                return user;
            });
            
            localStorage.setItem('users', JSON.stringify(users));
            addTestResult('success', `‚úÖ ƒê√£ migrate ${migrated} m·∫≠t kh·∫©u c≈©`);
            displayUsers();
        }

        // Load status on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus();
            displayUsers();
            
            // Auto update every 3 seconds
            setInterval(() => {
                updateStatus();
                displayUsers();
            }, 3000);
        });
    </script>
</body>
</html>